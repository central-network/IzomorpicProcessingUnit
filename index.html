<meta charset="utf8" />

<script type="module">
    import LocalSharedMemory from "./node_modules/localsharedmemory/index.js"
    import { GPU, NPU, CPU } from "./index.js"
    
    const source = new Float32Array(2e5).map(Math.random)
    const values = Float32Array.of(2.4)
    
    const npu = new NPU();
    npu.on("ready", async e => {
        console.warn("npu ready:", npu)

        const target = new Float32Array(source.length);
        const result = await npu.f32_mul( source, values, target );
        
        console.log("npu results:", result)
    });

    const gpu = new GPU();
    gpu.on("ready", async e => {
        console.warn("gpu ready:", gpu)

        const target = new Float32Array(source.length);
        const result = await gpu.f32_mul( source, values, target );

        console.log("gpu results:", result)
    });

    const cpu = new CPU();
    cpu.on("ready", async e => {
        console.warn("cpu ready:", cpu)

        const target = new Float32Array(source.length);
        const result = await cpu.f32_mul( source, values, target );

        console.log("cpu results:", result)

        setTimeout(async () => {
            const result = await cpu.f32_add( source, values, target );
            console.log("cpu results:", result)
        }, 1000)
    });

</script>